# FonctionnalitÃ© de rÃ©servation pour les webinaires

## 1. Introduction 

Cette partie du TP implÃ©mente la fonctionnalitÃ© permettant aux utilisateurs de rÃ©server une place pour un webinaire. Elle inclut :

- La vÃ©rification des rÃ¨gles mÃ©tier (places disponibles, inscription existante).
- La gestion des participations.
- L'envoi d'un email Ã  l'organisateur pour notifier une nouvelle inscription.
- La mise Ã  jour des tests unitaires pour valider cette fonctionnalitÃ©.

## 2. FonctionnalitÃ©s principales

### RÃ©server une place pour un webinaire
- RÃ©duit le nombre de siÃ¨ges disponibles.
- Enregistre la participation de l'utilisateur.
- Envoie une notification par email Ã  l'organisateur.

### RÃ¨gles mÃ©tier vÃ©rifiÃ©es
- Les webinaires doivent avoir des places disponibles.
- L'utilisateur ne peut pas s'inscrire deux fois au mÃªme webinaire.
- L'utilisateur ne peut pas s'inscrire Ã  un webinaire inexistant.

### Tests unitaires
- Happy path (rÃ©servation rÃ©ussie).
- Cas d'erreur (plus de places disponibles, utilisateur dÃ©jÃ  inscrit, webinaire inexistant, organisateur n'existe pas).

## 3. Modifications apportÃ©es 

### Ports

- **`src/webinars/ports/webinar-repository.interface.ts`** : `IWebinarRepository`, dÃ©finition des mÃ©thodes nÃ©cessaires pour gÃ©rer les webinaires.
- **`src/webinars/ports/participation-repository.interface.ts`** : `IParticipationRepository`, dÃ©finition des mÃ©thodes nÃ©cessaires pour gÃ©rer les participants.

### Use case 

- **`src/webinars/use-cases/book-seat.ts`** :
  - Permet Ã  un utilisateur de rÃ©server une place dans le webinaire.
  - Applique les rÃ¨gles mÃ©tier : vÃ©rification des places disponibles et prÃ©vention des doubles inscriptions.
  - Envoie une notification par e-mail Ã  l'organisateur en cas de rÃ©servation rÃ©ussie.

### Tests 	

- **`src/webinars/use-cases/book-seat.test.ts`** : DÃ©finit les tests pour valider la fonctionnalitÃ© de rÃ©servation de places.  
  Les tests couvrent bien : rÃ©servation rÃ©ussie, plus de places disponibles, utilisateur dÃ©jÃ  inscrit, webinaire inexistant.

### Repository 

- **`src/webinars/adapters/webinar-repository.in-memory.ts`** : `InMemoryWebinarRepository`, gÃ¨re les webinaires dans un tableau en mÃ©moire.
- **`src/webinars/adapters/participation-repository.in-memory.ts`** : `InMemoryParticipationRepository`, gÃ¨re les participations dans un tableau en mÃ©moire.

## 4. Instructions pour les tests 

Pour exÃ©cuter les tests, il faut lancer la commande : 

npm run test ou bien npm run test:watch

# TP ARCHITECTURE

## PrÃ©sentation du contexte

Vous dÃ©veloppez une application de gestion de webinaires en suivant les concepts de l'architecture Ports / Adapters.

Un `use-case` est dÃ©jÃ  implÃ©mentÃ© : organiser un webinaire.

Vos collÃ¨gues ont dÃ©jÃ  prÃ©parÃ© le terrain pour la suite, mais c'est maintenant Ã  vous de prendre le relais pour dÃ©velopper une autre fonctionnalitÃ© : rÃ©server sa place dans un webinaire.

## PrÃ©sentation de l'architecture

```
ğŸ“¦src
 â”£ ğŸ“‚core
 â”ƒ â”£ ğŸ“‚adapters
 â”ƒ â”ƒ â”£ ğŸ“œfixed-date-generator.ts
 â”ƒ â”ƒ â”£ ğŸ“œfixed-id-generator.ts
 â”ƒ â”ƒ â”£ ğŸ“œin-memory-mailer.ts
 â”ƒ â”ƒ â”£ ğŸ“œreal-date-generator.ts
 â”ƒ â”ƒ â”— ğŸ“œreal-id-generator.ts
 â”ƒ â”— ğŸ“‚ports
 â”ƒ â”ƒ â”£ ğŸ“œdate-generator.interface.ts
 â”ƒ â”ƒ â”£ ğŸ“œid-generator.interface.ts
 â”ƒ â”ƒ â”— ğŸ“œmailer.interface.ts
 â”£ ğŸ“‚shared
 â”ƒ â”£ ğŸ“œentity.ts
 â”ƒ â”— ğŸ“œexecutable.ts
 â”£ ğŸ“‚users
 â”ƒ â”£ ğŸ“‚adapters
 â”ƒ â”£ ğŸ“‚entities
 â”ƒ â”ƒ â”— ğŸ“œuser.entity.ts
 â”ƒ â”— ğŸ“‚ports
 â”ƒ â”ƒ â”— ğŸ“œuser-repository.interface.ts
 â”£ ğŸ“‚webinars
 â”ƒ â”£ ğŸ“‚adapters
 â”ƒ â”ƒ â”— ğŸ“œwebinar-repository.in-memory.ts
 â”ƒ â”£ ğŸ“‚entities
 â”ƒ â”ƒ â”— ğŸ“œwebinar.entity.ts
 â”ƒ â”£ ğŸ“‚exceptions
 â”ƒ â”ƒ â”£ ğŸ“œwebinar-dates-too-soon.ts
 â”ƒ â”ƒ â”£ ğŸ“œwebinar-not-enough-seats.ts
 â”ƒ â”ƒ â”— ğŸ“œwebinar-too-many-seats.ts
 â”ƒ â”£ ğŸ“‚ports
 â”ƒ â”ƒ â”— ğŸ“œwebinar-repository.interface.ts
 â”ƒ â”— ğŸ“‚use-cases
 â”ƒ â”ƒ â”£ ğŸ“œorganize-webinar.test.ts
 â”ƒ â”ƒ â”— ğŸ“œorganize-webinar.ts
```

Nous retrouvons plusieurs dossier :

- `core` module pour la dÃ©finition / implÃ©mentation de services techniques
- `shared` qui sont des classes utilitaires
- `users` et `webinars` qui sont nos modules business.

Chaque module va comporter obligatoirement :

- un dossier `ports` pour dÃ©finir les interfaces
- un dossier `adapters` pour implÃ©menter ces interfaces

Et Ã©ventuellement :

- un dossier `entities` qui sont nos entitÃ©es mÃ©tiers avec les rÃ¨gles de gestion si nÃ©cessaire
- un dossier `use-cases` reprenant les fonctionnalitÃ©s de notre application, ainsi que les tests unitaires assosciÃ©s
- ...

## Objectifs

Vous Ãªtes missionÃ©s pour rÃ©aliser un use-case : **rÃ©server sa place**.

Cette fonctionnalitÃ© comportera **2 rÃ¨gles mÃ©tier** importantes :

- vÃ©rifier le nombre de participants restants
- vÃ©rifier que l'on ne participe pas dÃ©jÃ  Ã  ce webinaire

Elle aura Ã©galement **1 side-effect** : envoyer un email Ã  l'organisateur pour mentioner qu'un nouveau participant s'est inscrit.

Pour vÃ©rifier votre travail, un test unitaire du use-case devra Ãªtre rÃ©alisÃ©.

Un modÃ¨le est dÃ©jÃ  prÃ©sent pour l'organisation de webinaires...

Vos collÃ¨gues vous ont prÃ©parÃ© le terrain avec la structure du use-case attendu (`book-seat`) et quelques interfaces pour vous guider (user / participation)...

_Ã€ vous d'implÃ©menter tout Ã§a Ã  l'image de ce qui a dÃ©jÃ  Ã©tÃ© rÃ©alisÃ© !_

## Astuces

La commande `npm run test:watch` pour lancer vos tests en watch mode.
